<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Para Mi Princesa Dorita üíñ</title>
  <script src="https://cdn.jsdelivr.net/npm/regl/dist/regl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gl-matrix@3.4.3/gl-matrix-min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 200vh;
      overflow-x: hidden;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      background: url('https://i.imgur.com/DkY2OQB.jpeg') repeat;
      background-size: auto;
      background-attachment: fixed;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 0;
    }
    #display {
      width: 100%;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1;
      pointer-events: none;
    }
    #mensaje {
      position: fixed;
      top: 40%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: #ffb6c1;
      z-index: 2;
      pointer-events: none;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="display"></div>
  <div id="mensaje">Buenos d√≠as, mi princesa. Te extra√±√© mucho, mi ni√±a hermosa. Espero que hayas dormido como un angelito. Eres mi alegr√≠a y mi sol cada ma√±ana. üíñ</div>
  <audio id="audio" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" autoplay loop style="display:none;"></audio>
  <script>
    const regl = createREGL({ container: '#display' });
    const { mat4 } = glMatrix;
    const audio = document.getElementById('audio');
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const source = ctx.createMediaElementSource(audio);
    const analyser = ctx.createAnalyser();
    source.connect(analyser);
    analyser.connect(ctx.destination);
    analyser.fftSize = 128;
    const data = new Uint8Array(analyser.frequencyBinCount);
    let beat = 1;
    function updateBeat() {
      analyser.getByteFrequencyData(data);
      const avg = data.reduce((a, b) => a + b, 0) / data.length;
      beat = 1 + avg / 256;
      requestAnimationFrame(updateBeat);
    }
    document.addEventListener('click', () => {
      ctx.resume();
      audio.play();
    });
    updateBeat();
    function heart2D(t) {
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      return [x * 0.05, y * 0.05];
    }
    const segments = 100;
    const depth = 0.2;
    const front = [], back = [], sides = [];
    for (let i = 0; i < segments; i++) {
      const t1 = (i / segments) * Math.PI * 2;
      const t2 = ((i + 1) / segments) * Math.PI * 2;
      const p1 = heart2D(t1);
      const p2 = heart2D(t2);
      front.push([0, 0, depth], [p1[0], p1[1], depth], [p2[0], p2[1], depth]);
      back.push([0, 0, -depth], [p2[0], p2[1], -depth], [p1[0], p1[1], -depth]);
      sides.push(
        [p1[0], p1[1], depth], [p2[0], p2[1], depth], [p2[0], p2[1], -depth],
        [p1[0], p1[1], depth], [p2[0], p2[1], -depth], [p1[0], p1[1], -depth]
      );
    }
    const positions = [...front, ...back, ...sides];
    const normals = positions.map(p => {
      const len = Math.hypot(p[0], p[1], p[2]);
      return len > 0 ? [p[0]/len, p[1]/len, p[2]/len] : [0, 0, 1];
    });
    const HEARTS = 30;
    const hearts = Array(HEARTS).fill().map(() => ({
      pos: [
        (Math.random() - 0.5) * 10,
        (Math.random() - 0.5) * 5,
        (Math.random() - 0.5) * 10
      ],
      rotSpeed: Math.random() * 0.01 + 0.005,
      phase: Math.random() * Math.PI * 2
    }));
    const drawHeart = regl({
      attributes: {
        position: regl.buffer(positions),
        normal: regl.buffer(normals)
      },
      uniforms: {
        projection: ({viewportWidth, viewportHeight}) =>
          mat4.perspective(mat4.create(), Math.PI / 4, viewportWidth / viewportHeight, 0.01, 100),
        view: () => {
          const t = performance.now() * 0.001;
          return mat4.lookAt(mat4.create(), [10 * Math.sin(t*0.3), 4, 10 * Math.cos(t*0.3)], [0, 0, 0], [0, 1, 0]);
        },
        model: (_, props) => {
          const t = performance.now() * 0.001;
          const scale = 0.5 + 0.3 * beat * Math.sin(t * 3 + props.phase);
          let m = mat4.create();
          mat4.translate(m, m, props.pos);
          mat4.rotateY(m, m, t * props.rotSpeed * 100);
          mat4.scale(m, m, [scale, scale, scale]);
          return m;
        },
        lightDir: [0.0, 1.0, 1.0]
      },
      vert: `
      precision mediump float;
      attribute vec3 position, normal;
      uniform mat4 projection, view, model;
      varying vec3 vNormal;
      void main() {
        vec4 world = model * vec4(position, 1.0);
        vNormal = mat3(model) * normal;
        gl_Position = projection * view * world;
      }`,
      frag: `
      precision mediump float;
      varying vec3 vNormal;
      uniform vec3 lightDir;
      void main() {
        vec3 normal = normalize(vNormal);
        vec3 light = normalize(lightDir);
        float diff = max(dot(normal, light), 0.0);
        vec3 ambient = vec3(0.2);
        vec3 baseColor = vec3(1.0, 0.2, 0.2);
        vec3 color = baseColor * diff + ambient;
        gl_FragColor = vec4(color, 1.0);
      }`,
      count: positions.length
    });
    regl.frame(() => {
      regl.clear({ color: [0, 0, 0, 0], depth: 1 });
      hearts.forEach(h => drawHeart(h));
    });
    const mensajes = [
      "Hola mi Dorita hermosa üíñ",
      "Eres mi alegr√≠a diaria üå∏",
      "Tu amor me da vida üíì",
      "Gracias por existir ‚ú®",
      "T√∫ y yo, siempre üíç",
      "Te amo infinito ‚ù§Ô∏è",
      "Eres lo mejor que me pas√≥ üí´",
      "Contigo todo es m√°s bonito üå∑",
      "Tu sonrisa es mi luz üåü",
      "Mi mundo empieza contigo üåé"
    ];
    let mensajeIndex = 0;
    const mensajeDiv = document.getElementById('mensaje');
    function mostrarMensaje() {
      mensajeDiv.textContent = mensajes[mensajeIndex % mensajes.length];
      mensajeIndex++;
    }
    let lastScroll = 0;
    window.addEventListener('scroll', () => {
      const now = window.scrollY;
      if (Math.abs(now - lastScroll) > 20) {
        mostrarMensaje();
        lastScroll = now;
      }
    }, { passive: true });
    document.getElementById('display').addEventListener('click', () => {
      mostrarMensaje();
    });
  </script>
</body>
</html>
